{
    "contents" : "## install the packages that are not yet instaled\n\ninstall.packages('jsonlite')\ninstall.packages('car')\ninstall.packages('rgdal')\ninstall.packages('stringr')\ninstall.packages('xlsx')\n\nlibrary(jsonlite)\nlibrary(car)\nlibrary(rgdal)\nlibrary(stringr)\nlibrary(xlsx)\n\nrm()\n\n\nalerte<-read.xlsx(\"ActivityInfo_Export_current.xls\",1,encoding=\"UTF-8\",startRow=2)\nnames(alerte)<-c(\"RRM-Interventions_-_ALERTES_SiteId\",\n                            \"DateCreated\",\"Date1\",\"Date2\",\"Partner\",\"OCHA_village_v2\",\"Axe\",\"AlerteID_(ORG_XXX_YYYYMMDD)\",\"Date_présumée_du_choc\",\"Nombre_de_localités/villages/sites_afféctés\",\n                            \"Population_affectee_-_total_menages\",\"Population_affectee_-_total_individus\",\"Nature_du_choc_Autre\",\"Nature_du_choc_Catastrophe_naturelle\",\"Nature_du_choc_Violences\",\n                            \"Population_affectee_Deplaces\",\"Population_affectee_Retours\",\"Population_affectee_Communaute_hote\",\"Population_affectee_Autre\",\"Acces_humanitaire_Oui\",\n                            \"Acces_humanitaire_Non_-_logistique\",\"Acces_humanitaire_Non_-_securite\",\"Acces_humanitaire_Non_-_autre\",\"Continue_Investigation_Oui\",\"Continue_Investigation_Non\",\n                            \"Alerte_en_cours_Oui\",\"Alerte_en_cours_Non\",\"Code_Préfecture\",\"Préfecture\",\"Code_Sous-Préfecture\",\"Sous-Préfecture\",\"Code_Commune\",\"Commune\",\n                            \"Code_Arrondissement\",\"Arrondissement\",\"Longitude\",\"Latitude\",\"Comments\")\n\nMEX<-read.xlsx(\"ActivityInfo_Export_current.xls\",2,encoding=\"UTF-8\",startRow=2)\nnames(MEX)<-c(\"RRM-Interventions - MISSION EXPLORATOIRE_SiteId\",\"DateCreated\",\"Date1\",\"Date2\",\"Partner\",\"OCHA_village_v2\",\"Axe\",\"AlerteID\",\"Nombre de localités/villages/sites afféctés\",\n              \"Nature de la crise  - Description\",\"Population affectee - total menages\",\"Population affectee - total individus\",\"Nature du choc_Violence\",\"Nature du choc_Catastrophe naturelle\",\n              \"Nature du choc_Autre\",\"Type de population_Communaute hote\",\"Type de population_Retours\",\"Type de population_Autre\",\"Type de population_Deplaces\",\"Statut du MEX_Completé\",\n              \"Statut du MEX_Prévu\",\"Statut du MEX_En cours\",\"Statut du MEX_En attente (délais)\",\"Statut du MEX_Annulé\",\"Cause de delais_Sécurité (pas d_accés humanitaire)\",\n              \"Cause de delais_Changement de contexte/ a suivre\",\"Cause de delais_Logistique (pas d_accés)\",\"Cause de delais_Autre\",\"Cause de delais_NA\",\n              \"Cause d_annulation_Conversion en MSA\",\"Cause d_annulation_Autre\",\"Cause d_annulation_NA\",\"Proposition d_action_MSA complete\",\n              \"Proposition d_action_Evaluation sectorielle\",\"Proposition d_action_Monitoring protection\",\"Proposition d_action_Rehabilitation acces logistique\",\n              \"Proposition d_action_Plaidoyer acces securitaire\",\"Proposition d_action_Suivi du retour des déplacés\",\n              \"Proposition d_action_Intervention(s) directe(s)\",\"Proposition d_action_Pas d_action\",\"Proposition d_action_Autre\",\n              \"Code Préfecture\",\"Préfecture\",\"Code Sous-Préfecture\",\"Sous-Préfecture\",\"Code Commune\",\"Commune\",\"Code Arrondissement\",\n              \"Arrondissement\",\"Longitude\",\"Latitude\",\"Comments\")\n\nMSA<-read.xlsx(\"ActivityInfo_Export_current.xls\",3,encoding=\"UTF-8\",startRow=2)\nnames(MSA)<-c(\"RRM-Interventions_-_MSA_SiteId\",\"DateCreated\",\"Date1\",\"Date2\",\"Partner\",\"OCHA_village_v2\",\"Axe\",\"AlerteID\",\"Nombre_de_localités_villages_sites_afféctés\",\n              \"Menage_déplacés\",\"Individus_déplacés\",\"Menage_retournes\",\"Individus_returnes\",\"Menages_acceuil\",\"Individus_acceuil\",\"Score_NFI\",\n              \"de_menages_vivant_ds_un_abris_en_dessous_des_standard\",\"des_menages_ayant_acces_a_une_latrine_hygienique\",\n              \"des_menages_avec_un_source_d_eau_potable_amelioree\",\"Taux_diarrhée_chez_les_enfants_de_moins_de_5_ans_au_cours_des_2_dernières_semaines\",\n              \"Score_Consommation_alimentaire\",\"score_de_Consommation_alimentaire_-_Acceptable\",\"score_de_Consommation_alimentaire_-_Limite\",\n              \"score_de_Consommation_alimentaire_-_Pauvre\",\"Score_startegie_de_survie\",\"decole_fonctionnelles\",\"MSAcount\",\"Population_affectees\",\n              \"Statut_du_MSA_Completé\",\"Statut_du_MSA_Prévu\",\"Statut_du_MSA_En_cours\",\"Statut_du_MSA_En_attente_délais_\",\"Statut_du_MSA_Annulé\",\n              \"Cause_de_delais_Sécurité_pas_d_accés_humanitaire_\",\"Cause_de_delais_Changement_de_contexte_a_suivre\",\"Cause_de_delais_Logistique_pas_d_accés_\",\n              \"Cause_de_delais_NA\",\"Cause_d_annulation_Conversion_en_MEX\",\"Cause_d_annulation_Planification_d_une_meme_evaluation_par_une_autre_agence\",\n              \"Cause_d_annulation_Autre\",\"Cause_d_annulation_NA\",\"Recommandation_s_du_MSA_Intervention_Abris_NFI\",\"Recommandation_s_du_MSA_Intervention_EAH\",\n              \"Recommandation_s_du_MSA_Pas_d_intervention\",\"Recommandation_s_du_MSA_Intervention_Santé_Nutrition\",\"Recommandation_s_du_MSA_Securité_Alimentaire\",\n              \"Recommandation_s_du_MSA_Intervention_Protection\",\"Recommandation_s_du_MSA_Intervention_Education\",\"Recommandation_s_du_MSA_Intervention_Logistique\",\n              \"Code_Préfecture\",\"Préfecture\",\"Code_Sous-Préfecture\",\"Sous-Préfecture\",\"Code_Commune\",\"Commune\",\"Code_Arrondissement\",\"Arrondissement\",\"Longitude\",\"Latitude\",\"Comments\")\n\ninter<-read.xlsx(\"ActivityInfo_Export_current.xls\",4,encoding=\"UTF-8\",startRow=2)\nnames(inter)<-c(\"RRM_Interventions_INTERVENTION_SiteId\",\"DateCreated\",\"Date1\",\"Date2\",\"Partner\",\"OCHA_village_v2\",\"Axe\",\"AlerteID\",\n                \"Nombres_de_localités_villages_sites_afféctés\",\"Individus_bénéficiaires_NFI_total\",\"individus_bénéficiaires_NFI_déplacés\",\n                \"individus_bénéficiaires_NFI_acceuil\",\"Ménages_bénéficiaires_NFI_total\",\"ménages_bénéficiaires_NFI_déplacés\",\n                \"ménages_bénéficiaires_NFI_accueil\",\"Kits_NFI_total\",\"KITS_NFI_déplacés\",\"Kits_NFI_accueil\",\"NFI_Savons_total\",\n                \"NFI_savon_déplacés\",\"NFI_savon_acceuil\",\"NFI_Couvertures_total\",\"NFI_couvertures_déplacés\",\"NFI_couvertures_accueil\",\n                \"NFI_Nattes_total\",\"NFI_nattes_déplacés\",\"NFI_Nattes_accueil\",\"NFI_bidons\",\"NFI_bidons_déplacés\",\"NFI_bidons_accueil\",\n                \"NFI_Moustiquaires\",\"NFI_Moustiquaires_déplacés\",\"NFI_Moustiquaires_accueil\",\"NFI_Bâches\",\"NFI_Baches_déplacés\",\"NFI_Baches_accueil\",\n                \"NFI_Torche\",\"NFI_torche_déplacés\",\"NFI_torche_accueil\",\"NFI_Seau\",\"NFI_seau_déplacés\",\"NFI_seau_accueil\",\"NFI_Kit_cuisine_total\",\n                \"NFI_Kit_cuisine_déplacés\",\"NFI_Kit_cuisine_accueil\",\"NFI_Vêtements_enfants_total\",\"NFI_Vêtements_enfants_déplacés\",\"NFI_Vêtements_enfants_accueil\",\n                \"NFI_Vêtement_bébé\",\"Kits_VIVRES\",\"Vivres_Huile_2L\",\"Vivres_Plumpy_Sup\",\"Vivres_CSB+_12,5Kg\",\"Vivres_Riz_25kg\",\"Individus_bénéficiaires_WASH_total\",\n                \"individus_bénéficiaires_WASH_déplacés\",\"individus_bénéficiaires_WASH_accueil\",\"Nombres_de_blocs_de_latrines\",\"nombres_de_latrines_installées\",\n                \"réhabilitation_de_forage_ou_source_d_eau\",\"Redynamisation_du_comité_de_gestion_de_la_source_d_eau\",\"Sensibilisation_de_la_communauté_lavage_de_main\",\n                \"Sensibilisation_de_la_communauté_sur_les_bonnes_pratiques_d’hygiène.\",\"Mise_en_place_d_un_comité_de_gestion_des_latrines\",\"Autre_intervention_WASH\",\n                \"Abris\",\"interventioncount\",\"Type_d_intervention_NFI_WASH\",\"Type_d_intervention_NFI\",\"Type_d_intervention_WASH\",\"Statut_de_l_intervention_NFI_Completé\",\n                \"Statut_de_l_intervention_NFI_Prévu\",\"Statut_de_l_intervention_NFI_En_cours\",\"Statut_de_l_intervention_NFI_En_attente_délais_\",\"Statut_de_l_intervention_NFI_Annulé\",\n                \"Statut_de_l_intervention_NFI_NA\",\"Cause_de_délais_NFI_Sécurité_pas_d_accés_humanitaire_\",\"Cause_de_délais_NFI_Changement_de_contexte_a_suivre\",\n                \"Cause_de_délais_NFI_Logistique_pas_d_accés_\",\"Cause_de_délais_NFI_NA\",\"Cause_d_annulation_NFI_Possibilité_d_une_intervention_par_une_autre_agence\",\n                \"Cause_d_annulation_NFI_Sécurité\",\"Cause_d_annulation_NFI_NA\",\"Statut_d_intervention_WASH_Completé\",\"Statut_d_intervention_WASH_Prévu\",\n                \"Statut_d_intervention_WASH_En_cours\",\"Statut_d_intervention_WASH_En_attente_délais_\",\"Statut_d_intervention_WASH_Annulé\",\n                \"Statut_d_intervention_WASH_NA\",\"Cause_de_delais_WASH_Sécurité_pas_d_accés_humanitaire_\",\"Cause_de_delais_WASH_Changement_de_contexte_a_suivre\",\n                \"Cause_de_delais_WASH_Logistique_pas_d_accés_\",\"Cause_de_delais_WASH_NA\",\"Cause_d_annulation_WASH_Possibilité_d_une_intervention_par_une_autre_agence\",\n                \"Cause_d_annulation_WASH_Sécurité\",\"Cause_d_annulation_WASH_NA\",\"Code_Préfecture\",\"Préfecture\",\"Code_Sous_Préfecture\",\"Sous_Préfecture\",\"Code_Commune\",\n                \"Commune\",\"Code_Arrondissement\",\"Arrondissement\",\"Longitude\",\"Latitude\",\"Comments\")\n\nPDM<-read.xlsx(\"ActivityInfo_Export_current.xls\",5,encoding=\"UTF-8\",startRow=2)\n\ndsn <-\"caf_admbnd3_200k_sigcaf.shp\"\n#ogrListLayers(dsn)\n#ogrInfo(dsn=dsn, layer=\"sous_pref\")\npref<-readOGR(dsn=dsn,layer=\"caf_admbnd3_200k_sigcaf\",encoding=\"UTF-8\")\n\nfor (i in 1:4)\n#i=4\n  {\n  if(i==1){db<-alerte}\n  if(i==2){db<-MEX}\n  if(i==3){db<-MSA}\n  if(i==4){db<-inter}\n  if(i==5){db<-PDM}\n    \n  \n  db<-as.data.frame(db,stringsAsFactors=FALSE)\n  names(db)<-gsub(\"\\\\s|-|_()+, \", \"_\",names(db))\n  names(db)<-gsub(\"__\", \"_\",names(db))\n  names(db)<-gsub(\"__\", \"_\",names(db))\n  \n  geo<-rep(\"NA\",length(db[,1]))\n  \n  for (co in 1:length(db[,1]))\n  {\n    geo[co]<-paste(db$Latitude[co],db$Longitude[co],sep=\",\")\n  }\n  \n  del<-c(which(names(db)==\"Comments\")*-1)\n  db<-db[,del]\n  db<-cbind(db,geo)\n  db<-as.data.frame(db)\n  \n  gpdate<-which(str_detect(names(db), \"Date\") %in% FALSE)\n\n  for (j in gpdate){\n    db[,j]<-recode(db[,j],\"TRUE=1;FALSE=0;NA=0\")\n  }\n  \n  proj_layer<-CRS(\"+proj=longlat +datum=WGS84\")\n  coordinates(db) = ~Longitude+Latitude\n  proj4string(db)<-\"+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0\"#cities<-readOGR(RRM,layer=\"MSA\")\n  join<-over(db,pref)\n  join<-join[,c(4,6,8,10)]\n  \n  db$Date1<-as.Date(db$Date1,\"%Y-%m-%d\")\n  db$Date1<-as.Date(db$Date2,\"%Y-%m-%d\")\n  month<- format(db$Date1, \"%Y-%m\")\n  year<- format(db$Date1, \"%Y\")\n  db<-cbind(db,month,year,join)\n  db<-as.data.frame(db,stringsAsFactors=FALSE)\n  \n  \n  if(i==1){\n  \n  db$Acces_humanitaire_Oui<-ifelse(db$Acces_humanitaire_Oui==1,\"Oui\",NA)\n  db$Acces_humanitaire_Non_logistique<-ifelse(db$Acces_humanitaire_Non_logistique==1,\"Non - logistique\",NA)\n  db$Acces_humanitaire_Non_autre<-ifelse(db$Acces_humanitaire_Non_autre==1,\"Non - autre\",NA)\n  db$Acces_humanitaire_Non_securite<-ifelse(db$Acces_humanitaire_Non_securite==1,\"Non - securité\",NA)\n  \n  db$Continue_Investigation_Oui<-ifelse(db$Continue_Investigation_Oui==1,\"Oui\",NA)\n  db$Continue_Investigation_Non<-ifelse(db$Continue_Investigation_Non==1,\"Non\",NA)\n  \n  #db$Alerte_en_cours_Non<-ifelse(db$Alerte_en_cours_Non==1,\"Non\",NA)\n  db$Alerte_en_cours_Oui<-ifelse(db$Alerte_en_cours_Oui==1,\"Oui\",\"Non\")\n  \n  db$Nature_du_choc_Catastrophe_naturelle<-ifelse(db$Nature_du_choc_Catastrophe_naturelle,\"Castastrophe naturelle\",NA)\n  db$Nature_du_choc_Violences<-ifelse(db$Nature_du_choc_Violences==1,\"Violence\",NA)\n  #db$Nature_du_choc_Autre<-ifelse(db$Nature_du_choc_Autre==1,\"Autre\",NA)\n  \n  db$Population_affectee_Communaute_hote<-ifelse(db$Population_affectee_Communaute_hote==1,\"Communautés d'acceuil\",NA)\n  db$Population_affectee_Deplaces<-ifelse(db$Population_affectee_Deplaces==1,\"Deplacés\",NA)\n  db$Population_affectee_Retours<-ifelse(db$Population_affectee_Retours==1,\"Retours\",NA)\n  db$Population_affectee_Autre<-ifelse(db$Population_affectee_Autre==1,\"Autre\",NA)\n  \n  acces<-paste(db$Acces_humanitaire_Oui,\n               db$Acces_humanitaire_Non_logistique,\n               db$Acces_humanitaire_Non_autre,\n               db$Acces_humanitaire_Non_securite,sep=\" \")\n  \n  continu<-paste(db$Continue_Investigation_Oui,\n                 db$Continue_Investigation_Non,sep=\" \")\n  \n  alerte_cours<-db$Alerte_en_cours_Oui\n  \n  nature<-paste(\n    db$Nature_du_choc_Catastrophe_naturelle,\n    db$Nature_du_choc_Violences,sep=\" \")\n  \n  pop_affect<-paste(\n    db$Population_affectee_Communaute_hoste,\n    db$Population_affectee_Deplaces,\n    db$Population_affectee_Retours,\n    db$Population_affectee_Autre,sep=\" \")\n  \n  \n  type_inter<-rep(\"Alerte\",length(db[,1]))\n  \n  db<-cbind(db,acces,continu,alerte_cours,nature,pop_affect,type_inter)\n  \n  db<-as.data.frame(sapply(db,gsub,pattern=\"NA \",replacement=\"\"))\n  db<-as.data.frame(sapply(db,gsub,pattern=\" NA\",replacement=\"\"))\n  db<-as.data.frame(sapply(db,gsub,pattern=\"  \",replacement=\" \"))\n  db<-as.data.frame(sapply(db,str_trim))\n  \n  write.csv(db,\"RRM_incident.csv\",row.names=FALSE,fileEncoding = \"UTF-8\")\n  \n  \n  db$Latitude <- as.numeric(levels(db$Latitude)[db$Latitude])\n  db$Longitude <- as.numeric(levels(db$Longitude)[db$Longitude])\n  alerte_geo<-SpatialPointsDataFrame(db[,36:37],db)\n  \n  #Write as geojson\n  writeOGR(alerte_geo,\"alerte_geo\",'alerte_geo2', driver='GeoJSON',delete_dsn=TRUE,overwrite_layer=TRUE) \n  g<-read.table(\"alerte_geo\",header=FALSE,sep=\"#\",stringsAsFactor =FALSE,quote=\"\")\n  g[1,]<-paste(\"var alerte = \",as.character(g[1,]))\n  \n  write.table(g,\"alerte.json\",row.names=FALSE,col.names=FALSE,quote=FALSE)\n  \n  \n  \n  \n  }\n  \n##################################################################\nif(i==2){\n\ndb$Proposition_d_action_Plaidoyer_acces_securitaire <-ifelse(db$Proposition_d_action_Plaidoyer_acces_securitaire==1,\"Plaidoyer accès sécuritaire\",NA)\ndb$Proposition_d_action_Intervention.s._directe.s. <-ifelse(db$Proposition_d_action_Intervention.s._directe.s.==1,\"Intervention directe\",NA)\ndb$Proposition_d_action_MSA_complete <-ifelse(db$Proposition_d_action_MSA_complete==1,\"MSA complète\",NA)\ndb$Proposition_d_action_Rehabilitation_acces_logistique  <-ifelse(db$Proposition_d_action_Rehabilitation_acces_logistique==1,\"Réhabilitation accès logistique\",NA)\ndb$Proposition_d_action_Evaluation_sectorielle  <-ifelse(db$Proposition_d_action_Evaluation_sectorielle==1,\"Evaluation sectorielle\",NA)\ndb$Proposition_d_action_Autre   <-ifelse(db$Proposition_d_action_Autre ==1,\"Autre\",NA)\ndb$Proposition_d_action_Monitoring_protection  <-ifelse(db$Proposition_d_action_Monitoring_protection==1,\"Suivi protection\",NA)\ndb$Proposition_d_action_Suivi_du_retour_des_déplacés <-ifelse(db$Proposition_d_action_Suivi_du_retour_des_déplacés==1,\"Suivi de retour des déplacés\",NA)\ndb$Nature_du_choc_Violence <-ifelse(db$Nature_du_choc_Violence==1,\"Violence\",NA)\ndb$Nature_du_choc_Catastrophe_naturelle <-ifelse(db$Nature_du_choc_Catastrophe_naturelle==1,\"Catastrophe naturelle\",NA)\ndb$Type_de_population_Deplaces <-ifelse(db$Type_de_population_Deplaces==1,\"Deplacés\",NA)\ndb$Type_de_population_Autre <-ifelse(db$Type_de_population_Autre==1,\"Autre\",NA)\ndb$Type_de_population_Communaute_hote <-ifelse(db$Type_de_population_Communaute_hote==1,\"Communautés d'acceuil\",NA) \ndb$Type_de_population_Retours <-ifelse(db$Type_de_population_Retours ==1,\"Retours\",NA)\n\nproposition<-paste(db$Proposition_d_action_Plaidoyer_acces_securitaire,db$Proposition_d_action_Intervention.s._directe.s.,\n                   db$Proposition_d_action_MSA_complete,db$Proposition_d_action_Rehabilitation_acces_logistique,\n                   db$Proposition_d_action_Evaluation_sectorielle,db$Proposition_d_action_Autre,\n                   db$Proposition_d_action_Monitoring_protection,db$Proposition_d_action_Suivi_du_retour_des_déplacés,sep=\" \")\n\nNature_choc<-paste(db$Nature_du_choc_Violence,db$Nature_du_choc_Catastrophe_naturelle,sep=\" \")\npop_type<-paste(db$Type_de_population_Deplaces,db$Type_de_population_Autre,db$Type_de_population_Communaute_hote,db$Type_de_population_Retours,sep=\" \")\n\n\ntype_inter<-rep(\"MEX\",length(db[,1]))\n\ndb<-cbind(db,pop_type,proposition,Nature_choc,type_inter)\n\ndb<-as.data.frame(sapply(db,gsub,pattern=\"NA \",replacement=\"\"))\ndb<-as.data.frame(sapply(db,gsub,pattern=\" NA\",replacement=\"\"))\ndb<-as.data.frame(sapply(db,gsub,pattern=\"  \",replacement=\" \"))\ndb<-as.data.frame(sapply(db,str_trim))\n\n\n\nwrite.csv(db,\"RRM_MEX.csv\",row.names=FALSE,fileEncoding = \"UTF-8\")\n\ndb$Latitude <- as.numeric(levels(db$Latitude)[db$Latitude])\ndb$Longitude <- as.numeric(levels(db$Longitude)[db$Longitude])\nMEX_geo<-SpatialPointsDataFrame(db[,50:51],db)\n\n#Write as geojson\nwriteOGR(MEX_geo,\"MEX_geo\",'MEX_geo2', driver='GeoJSON',delete_dsn=TRUE,overwrite_layer=TRUE) \ng<-read.table(\"MEX_geo\",header=FALSE,sep=\"#\",stringsAsFactor =FALSE,quote=\"\")\ng[1,]<-paste(\"var MEX = \",as.character(g[1,]))\n\nwrite.table(g,\"MEX.json\",row.names=FALSE,col.names=FALSE,quote=FALSE)\n\n\n\n\n\n}\n\n\nif(i==3){\n  db$Recommandation_s_du_MSA_Pas_d_intervention<-ifelse(db$Recommandation_s_du_MSA_Pas_d_intervention==1,\"Pas d'intervention\",NA)\n  #db$Recommandation_s_du_MSA_Intervention_WASH<-ifelse(db$Recommandation_s_du_MSA_Intervention_WASH==1,\"Intervention_WASH\",NA)\n  db$Recommandation_s_du_MSA_Intervention_Abris_NFI<-ifelse(db$Recommandation_s_du_MSA_Intervention_Abris_NFI==1,\"Intervention abris\",NA)\n  db$Recommandation_s_du_MSA_Intervention_EAH<-ifelse(db$Recommandation_s_du_MSA_Intervention_EAH==1,\"Intervention EHA\",NA)\n  db$Recommandation_s_du_MSA_Intervention_Santé_Nutrition<-ifelse(db$Recommandation_s_du_MSA_Intervention_Santé_Nutrition==1,\"Intervention santé/nutrition\",NA)\n  db$Recommandation_s_du_MSA_Securité_Alimentaire<-ifelse(db$Recommandation_s_du_MSA_Securité_Alimentaire==1,\"Intervention sécurité alimentaire\",NA)\n  \n  recommandation<-paste(db$Recommandation_s_du_MSA_Pas_d_intervention,\n                        #db$Recommandation_s_du_MSA_Intervention_WASH,\n                        db$Recommandation_s_du_MSA_Intervention_Abris_NFI,\n                        db$Recommandation_s_du_MSA_Intervention_EAH,\n                        db$Recommandation_s_du_MSA_Intervention_Santé_Nutrition,\n                        db$Recommandation_s_du_MSA_Securité_Alimentaire,sep=\" \")\n  \n  db<-cbind(db,recommandation)\n  db<-as.data.frame(sapply(db,gsub,pattern=\"NA \",replacement=\"\"))\n  db<-as.data.frame(sapply(db,gsub,pattern=\" NA\",replacement=\"\"))\n  db<-as.data.frame(sapply(db,gsub,pattern=\"  \",replacement=\" \"))\n  db<-as.data.frame(sapply(db,str_trim))\n  \n# names(db)<-c(\"field\",\"id\",\"locationName\",\"partnerName\",\"activity\",\"activityName\",\"startDate\",\"endDate\",\"MSAcount\",\"score_de_Consommation_alimentaire_Pauvre\",\"Individus_IDPs\",\"des_menages_ayant_acces_a_une_latrine_hygienique\",\n#             \"de_menages_vivant_ds_un_abris_en_dessous_des_standard\",\"Menage_retournes\",\"Menages_hote\",\"Score_NFI\",\"Individus_returnes\",\"score_de_Consommation_alimentaire_Limite\",\"score_de_Consommation_alimentaire_Acceptable\",\n#               \"Individus_hote\",\"decole_fonctionnelles\",\"Menage_IDPs\",\"Score_startegie_de_survie\",\"des_menages_avec_un_source_deau_potable_amelioree\",\"Score_Consommation_alimentaire\",\"Taudiarrhee_chez_les_enfants_de_moins_de_5_ans__au_cours_des_2_dernieres_semaines\",\n#               \"Recommandations_du_MSAPas_dintervention\",\"Recommandations_du_MSAIntervention_SanteNutrition\",\"Recommandations_du_MSASecurite_Alimentaire\",\"Recommandations_du_MSAIntervention_AbrisNFI\",\n#               \"Recommandations_du_MSAIntervention_EAH\",\"Recommandations_du_MSA_Intervention_Protection\",\"Recommandations_du_MSA_Intervention_Education\",\"Cause delais\",\"Cause_annulation\",\n#               \"type1\",\"geo\",\"X\",\"Y\",\"month\",\"year\",\"REGION_NOM\",\"PREF_NOM\",\"SPREF_NOM\",\"COM_NOM\",\"recommandation\")\n  \n  db<-as.data.frame(db,stringsAsFactors=FALSE)\n  \n  score_de_Consommation_alimentaire_PauvreBorder<-as.numeric(levels(db$score_de_Consommation_alimentaire_Pauvre)[db$score_de_Consommation_alimentaire_Pauvre])+\n    as.numeric(levels(db$score_de_Consommation_alimentaire_Limite)[db$score_de_Consommation_alimentaire_Limite])\n  \n  score_de_Consommation_alimentaire_PauvreBorder<-\n    ifelse(score_de_Consommation_alimentaire_PauvreBorder<20,\"0-20%\",\n           ifelse(score_de_Consommation_alimentaire_PauvreBorder<40,\"20-39%\",\n                  ifelse(score_de_Consommation_alimentaire_PauvreBorder<60,\"40-59%\",\n                         ifelse(score_de_Consommation_alimentaire_PauvreBorder<80,\"60-79%\",\n                                ifelse(score_de_Consommation_alimentaire_PauvreBorder<=100,\"80-100%\")))))\n  \n  db$score_de_Consommation_alimentaire_Pauvre<-\n    ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Pauvre)[db$score_de_Consommation_alimentaire_Pauvre])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Pauvre)[db$score_de_Consommation_alimentaire_Pauvre])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Pauvre)[db$score_de_Consommation_alimentaire_Pauvre])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Pauvre)[db$score_de_Consommation_alimentaire_Pauvre])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Pauvre)[db$score_de_Consommation_alimentaire_Pauvre])<=100,\"80-100%\")))))\n  \n  db$score_de_Consommation_alimentaire_Limite<-\n    ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Limite)[db$score_de_Consommation_alimentaire_Limite])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Limite)[db$score_de_Consommation_alimentaire_Limite])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Limite)[db$score_de_Consommation_alimentaire_Limite])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Limite)[db$score_de_Consommation_alimentaire_Limite])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Limite)[db$score_de_Consommation_alimentaire_Limite])<=100,\"80-100%\")))))\n  \n  db$score_de_Consommation_alimentaire_Acceptable<-\n    ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Acceptable)[db$score_de_Consommation_alimentaire_Acceptable])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Acceptable)[db$score_de_Consommation_alimentaire_Acceptable])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Acceptable)[db$score_de_Consommation_alimentaire_Acceptable])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Acceptable)[db$score_de_Consommation_alimentaire_Acceptable])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$score_de_Consommation_alimentaire_Acceptable)[db$score_de_Consommation_alimentaire_Acceptable])<=100,\"80-100%\")))))\n  \n  db$des_menages_ayant_acces_a_une_latrine_hygienique<-\n    ifelse(as.numeric(levels(db$des_menages_ayant_acces_a_une_latrine_hygienique)[db$des_menages_ayant_acces_a_une_latrine_hygienique])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$des_menages_ayant_acces_a_une_latrine_hygienique)[db$des_menages_ayant_acces_a_une_latrine_hygienique])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$des_menages_ayant_acces_a_une_latrine_hygienique)[db$des_menages_ayant_acces_a_une_latrine_hygienique])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$des_menages_ayant_acces_a_une_latrine_hygienique)[db$des_menages_ayant_acces_a_une_latrine_hygienique])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$des_menages_ayant_acces_a_une_latrine_hygienique)[db$des_menages_ayant_acces_a_une_latrine_hygienique])<=100,\"80-100%\")))))\n  \n  db$de_menages_vivant_ds_un_abris_en_dessous_des_standard<-\n    ifelse(as.numeric(levels(db$de_menages_vivant_ds_un_abris_en_dessous_des_standard)[db$de_menages_vivant_ds_un_abris_en_dessous_des_standard])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$de_menages_vivant_ds_un_abris_en_dessous_des_standard)[db$de_menages_vivant_ds_un_abris_en_dessous_des_standard])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$de_menages_vivant_ds_un_abris_en_dessous_des_standard)[db$de_menages_vivant_ds_un_abris_en_dessous_des_standard])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$de_menages_vivant_ds_un_abris_en_dessous_des_standard)[db$de_menages_vivant_ds_un_abris_en_dessous_des_standard])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$de_menages_vivant_ds_un_abris_en_dessous_des_standard)[db$de_menages_vivant_ds_un_abris_en_dessous_des_standard])<=100,\"80-100%\")))))\n  \n  db$decole_fonctionnelles<-\n    ifelse(as.numeric(levels(db$decole_fonctionnelles)[db$decole_fonctionnelles])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$decole_fonctionnelles)[db$decole_fonctionnelles])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$decole_fonctionnelles)[db$decole_fonctionnelles])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$decole_fonctionnelles)[db$decole_fonctionnelles])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$decole_fonctionnelles)[db$decole_fonctionnelles])<=100,\"80-100%\")))))\n  \n  db$des_menages_avec_un_source_d_eau_potable_amelioree<-\n    ifelse(as.numeric(levels(db$des_menages_avec_un_source_d_eau_potable_amelioree)[db$des_menages_avec_un_source_d_eau_potable_amelioree])<20,\"0-20%\",\n           ifelse(as.numeric(levels(db$des_menages_avec_un_source_d_eau_potable_amelioree)[db$des_menages_avec_un_source_d_eau_potable_amelioree])<40,\"20-39%\",\n                  ifelse(as.numeric(levels(db$des_menages_avec_un_source_d_eau_potable_amelioree)[db$des_menages_avec_un_source_d_eau_potable_amelioree])<60,\"40-59%\",\n                         ifelse(as.numeric(levels(db$des_menages_avec_un_source_d_eau_potable_amelioree)[db$des_menages_avec_un_source_d_eau_potable_amelioree])<80,\"60-79%\",\n                                ifelse(as.numeric(levels(db$des_menages_avec_un_source_d_eau_potable_amelioree)[db$des_menages_avec_un_source_d_eau_potable_amelioree])<=100,\"80-100%\")))))\n  \n\n  type_inter<-rep(\"MSA\",length(db[,1]))\n  db<-cbind(db,score_de_Consommation_alimentaire_PauvreBorder,type_inter)\n\n  write.csv(db,\"RRM_MSA.csv\",row.names=FALSE,fileEncoding = \"UTF-8\")\n  \n  db$Latitude <- as.numeric(levels(db$Latitude)[db$Latitude])\n  db$Longitude <- as.numeric(levels(db$Longitude)[db$Longitude])\n  MSA_geo<-SpatialPointsDataFrame(db[,58:59],db)\n  \n  #Write as geojson\n  writeOGR(MSA_geo,\"MSA_geo\",'MSA_geo2', driver='GeoJSON',delete_dsn=TRUE,overwrite_layer=TRUE) \n  g<-read.table(\"MSA_geo\",header=FALSE,sep=\"#\",stringsAsFactor =FALSE,quote=\"\")\n  g[1,]<-paste(\"var MSA = \",as.character(g[1,]))\n  \n  write.table(g,\"MSA.json\",row.names=FALSE,col.names=FALSE,quote=FALSE)\n\n\n}\n\nif(i==4)\n{\n  db$Type_d_intervention_WASH<-ifelse(db$Type_d_intervention_WASH==1,\"EHA*\",NA)\n  db$Type_d_intervention_NFI<-ifelse(db$Type_d_intervention_NFI==1,\"NFI*\",NA)\n  #db$Type_d_intervention_NFI_WASH_Abris<-ifelse(db$Type_d_intervention_NFI_WASH_Abris==1,\"NFI/WASH/Abri\",NA)\n  db$Type_d_intervention_NFI_WASH<-ifelse(db$Type_d_intervention_NFI_WASH==1,\"NFI/EHA*\",NA)\n  \n  intervention_type<-paste(db$Type_d_intervention_WASH,db$Type_d_intervention_NFI,\n                           db$Type_d_intervention_NFI_WASH_Abris,db$Type_d_intervention_NFI_WASH,sep=\" \")\n  type<-rep(\"1\",length(db[,1]))\n  type_inter<-rep(\"Intervention\",length(db[,1]))\n  db<-cbind(db,intervention_type,type,type_inter)\n  \n  db<-as.data.frame(sapply(db,gsub,pattern=\"NA \",replacement=\"\"))\n  db<-as.data.frame(sapply(db,gsub,pattern=\" NA\",replacement=\"\"))\n  db<-as.data.frame(sapply(db,gsub,pattern=\"  \",replacement=\" \"))\n  db<-as.data.frame(sapply(db,str_trim))\n\n  write.csv(db,\"RRM_intervention.csv\",row.names=FALSE,fileEncoding = \"UTF-8\")\n  \n  db$Latitude <- as.numeric(levels(db$Latitude)[db$Latitude])\n  db$Longitude <- as.numeric(levels(db$Longitude)[db$Longitude])\n  inter_geo<-SpatialPointsDataFrame(db[,105:106],db)\n  \n  #Write as geojson\n  writeOGR(inter_geo,\"inter_geo\",'inter_geo2', driver='GeoJSON',delete_dsn=TRUE,overwrite_layer=TRUE) \n  g<-read.table(\"inter_geo\",header=FALSE,sep=\"#\",stringsAsFactor =FALSE,quote=\"\")\n  g[1,]<-paste(\"var inter = \",as.character(g[1,]))\n  write.table(g,\"inter.json\",row.names=FALSE,col.names=FALSE,quote=FALSE)\n}\n}\n\n",
    "created" : 1429084992845.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "550758317",
    "id" : "905B8F3F",
    "lastKnownWriteTime" : 1429102466,
    "path" : "C:/wamp/www/RCA_RRM/data/script_v2.R",
    "project_path" : "script_v2.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}