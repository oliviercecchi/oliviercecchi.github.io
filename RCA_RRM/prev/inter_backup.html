<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="fr">
<head>
	
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
    <title>RRM RCA - Intervention</title>
	
	<script type="text/javascript" src="js/RRM_RCA_area_intervention.js"></script>
	<script type="text/javascript" src="js/RRM_RCA_admin1.js"></script>

    <!-- Bootstrap -->
	
	<script src="js/html5.js"></script>
	<link type="text/css" rel="stylesheet" href="css/bootstrap.css">
    <link type="text/css" href="css/leaflet.css" rel="stylesheet"/>
    <link type="text/css" href="css/leaflet.markercluster.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/dc.css">
    <!-- Add IntroJs styles  -->
    <link rel="stylesheet" type="text/css" href="css/introjs.css">
    <link rel="stylesheet" type="text/css" href="css/dashboard.css">
    <link rel="stylesheet" type="text/css" href="css/colorbrewer.css">

    <link href="font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	

<style>
/* Change the styles below in order to customize your template */

body{font-family: Helvetica, Arial; font-weight: regular; font-size: 15px; color: #555; background-color: #FFF; margin: 0;}
h1{font-weight: bold; font-size: 31px; letter-spacing: -1px; color: #333; line-height: 33px;}
h3{font-weight: bold; font-size: 20px; color: #fff; text-transform: uppercase; margin: 10px 0 0 0;}
h4{font-size: 12px; color: #000; margin: 10px 0 0 10px;}
p{margin: 8px 0 20px 0; line-height: 18px;}
a, a:visited{color: #397DB8; text-decoration: none;}
a:hover{text-decoration: underline;}

.wrapper{display: block; margin: 50px 0 0 0; padding: 4px 30px 0 30px;}

.map{background-color:#eee; position: absolute; top: 50px; left: 0; bottom: 0; width: 55%; *height:100%;}
.sidepanel{background-color:#b6b6b6; position: absolute; top: 0px; right: 0;  bottom: 0; width: 45%; height: 100%; overflow: auto}

.context{font-family: Helvetica, Arial; font-size: 13px; color: #999; padding: 10px 0 0 0;}
.subheader{border-bottom: 1px solid #ddd;}
.footer{border-top: 1px solid #ddd; margin-top: 30px;}
.titleBlock{text-align: right;
/* Here are the styles that makes the template responsive*/
@media only screen and (max-width: 768px) {
  .map{position: inherit; height: 400px; width: 100%; display: block;}
  .sidepanel{position: inherit; width: 100%;}
}
@media only screen and (max-width: 480px) {
  .map {height: 300px;}
}
.bar rect {
  shape-rendering: crispEdges;
}
.bar text {
  text-anchor: end;
}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
</style>

</head>
 <body>
  <!-- <a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
<nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
        <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
        <li class="sidebar-brand">
            <a href="#top">Dashboard</a>
        </li>
        <li>
            <a href="#gen">General Info</a>
        </li>
        <li>
            <a href="#map">Map</a>
        </li>
        <li>
            <a href="#dem">Demographic</a>
        </li>
        <li>
            <a href="#WASH">WASH</a>
        </li>
        <li>
            <a href="#Shelter">Shelter</a>
        </li>
        <li>
            <a href="#health">Health</a>
        </li>
        <li>
            <a href="#assist">Assistance</a>
        </li>
        <li>
            <a href="#obs">Observation</a>
        </li>
    </ul>
</nav>-->
  <nav class="navbar navbar-inverse navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">RRM Republique Centrafricaine</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Type d'activites <span class="caret"></span></a>
			  
              <ul class="dropdown-menu" role="menu">
                <li><a href="Activity_info.html">Carte de reference</a></li>
				<li><a href="Alerte.html">Alerte</a></li>
                <li><a href="MSA.html">MSA</a></li>
                <li><a href="mex.html">MEx</a></li>
                <li><a href="inter.html">Intervention</a></li>
                <li><a href="pdm.html">PDM</a></li>
              </ul>
            </li>
			<a class="navbar-brand" href="#">MSA</a>
			</ul>
			<ul class="nav navbar-nav navbar-right">
			<li><a class="reset" id="reset" href="#">Reset All</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>   
	
   <div style="display: block;"  id="dashboard">
             <div class="row" id="cccm">
                <div  class="map" id="cccm"  > </div>

                <div class="sidepanel">
					<div class="wrapper">
						  <p id="gen"><h3>Intervention</h3></p>
					</div>
						
						<div class="row">
							<div  class="col-md-4">
								<div  class="pref" id="cccm" class="dc-chart">
								  <h4>MSA par Prefecture</h4>
								</div>
							</div>
							
							<div  class="col-md-4">
								<div  class="prefpop" id="cccm" class="dc-chart">
										<h4>IPDs affectes par Prefecture</h4>
								</div>
							</div>
							<div  class="col-md-4">
								<div  class="SCORE_NFI" id="cccm" class="dc-chart">
								  <h4>Score NFI</h4>
								</div>
							</div>
						</div>
						 <div class="row">
							  <div  class="col-md-4">
								<div  class="FCS_poor" id="cccm" class="dc-chart">
									<h4>FCS_poor</h4>
								</div>
								
							  </div>
							  <div  class="col-md-4">
								<div  class="FCS_borderline" id="cccm" class="dc-chart">
								     <h4>FCS_borderline_poor</h4>
								</div>
							</div>
							 <div  class="col-md-4">
								<div  class="FCS_acceptable" id="cccm" class="dc-chart">
								     <h4>FCS_accep</h4>
								</div>
							</div>
						</div>	  
						<div class="row">
							<div  class="col-md-8">
							   <div Class ="start_dates" id="cccm" class="dc-lineChart">
								  <h4>Date de la MSA</h4>
								</div>
							</div>
							 <div  class="col-md-4">
								<div  class="year" id="cccm" class="dc-chart">
								     <h4>Annee</h4>
								</div>
							</div>
						</div>
					</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="js/intro.js"></script>
    <script type="text/javascript" src="js/d3_002.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
<!--maps-->
    <script type="text/javascript" src="js/leaflet.js"></script>
	<script type="text/javascript"  src="js/esri-leaflet.js"></script>
    <script type="text/javascript" src="js/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="js/dc.leaflet_inter.js"></script>
    <script type="text/javascript" src="js/colorbrewer.js"></script>

<script type="text/javascript">

/*     Markers      */

d3.csv("data/inter_melt.csv", function(error,data) {
     //drawMarkerSelect(data);
	 
     drawMarkerArea(data);
});

function regroup(dim, cols) {
    var _groupAll = dim.groupAll().reduce(
        function(p, v) { // add
            cols.forEach(function(c) {
                p[c] += v[c];
            });
            return p;
        },
        function(p, v) { // remove
            cols.forEach(function(c) {
                p[c] -= v[c];
            });
            return p;
        },
        function() { // init
            var p = {};
            cols.forEach(function(c) {
                p[c] = 0;
            });
            return p;
        });
    return {
        all: function() {
            // or _.pairs, anything to turn the object into an array
            return d3.map(_groupAll.value()).entries();
        }
    };
}

    function kitNFI(v) {return v.variable == "Kits_NFI_total";}
    function NFI_Baches(v) {return v.variable  == "NFI_Baches";}
    function NFI_bidons(v) {return v.variable  == "NFI_bidons";}
	function NFI_Couvertures(v) {return v.variable  == "NFI_Couvertures";}
    function NFI_Kit_cuisine_total(v) {return v.variable  == "NFI_Kit_cuisine_total";}
    function NFI_Moustiquaires(v) {return v.variable  == "NFI_Moustiquaires";}
	function NFI_Nattes(v) {return v.variable  == "NFI_Nattes";}
    function NFI_Savons(v) {return v.variable  == "NFI_Savons";}
    function NFI_Seau(v) {return v.variable  == "NFI_Seau";}
    function NFI_Torche(v) {return v.variable  == "NFI_Torche";}
    function NFI_Vetement_bebe(v) {return v.variable  == "NFI_Vetement_bebe";}
	function beneficairies_wash(v) {return v.variable  == "Individus_beneficiaires_NFI_total";}


function drawMarkerArea(db) {
//function drawMarkerSelect(error,data) {
	//var dateFormat = d3.time.format("%Y-%m");
	db.forEach(function (d) {
   // d.DD  = dateFormat.parse(d.month);
    //d.day = d3.time.day(d.dd);
	
    //convert to numbers
	//d.score_de_Consommation_alimentaire_Pauvre = +d.score_de_Consommation_alimentaire_Pauvre;
	d.numbers = +d.numbers;
});
  
  var xf = crossfilter(db);

  var pref =  xf.dimension(function(d) { return d.PREF_NOM; });
  
  var NFI_tot = pref.group().reduce(
                function(p, v) {
                    if (kitNFI(v)) {
                        p.totalCrimeRecords++;
                        p.totalCrimeRate += +v.numbers;
                    }
                    if (kitNFI(v)) {
                        p.violentCrimeRecords++;
                        p.violentCrimeRate += +v.numbers;
                    }
                    return p;
                },
                function(p, v) {
                    if (kitNFI(v)) {
                        p.totalCrimeRecords--;
                        p.totalCrimeRate -= +v.numbers;
                    }
                    if (kitNFI(v)) {
                        p.violentCrimeRecords--;
                        p.violentCrimeRate -= +v.numbers;
                    }
                    return p;
                },
                function() {
                    return {
                        totalCrimeRecords:0,totalCrimeRate:0
                    };
                }
        );
			
	var partner = xf.dimension(function(d) { return d.partnerName; });
	var partner_pop = partner.group().reduce(
					function(p, v) {
						if (beneficairies_wash(v)) {
							p.totalIntervention++;
							p.totalbeneficaire -= +v.numbers;
						}
						return p;
					},
					function(p, v) {
						if (beneficairies_wash(v)) {
							p.totalIntervention--;
							p.totalbeneficaire -= +v.numbers;
						}
						return p;
					},
					function() {
						return {
							totalIntervention:0,totalbeneficaire:0
						};
					}
			);

	var facilities = xf.dimension(function(d) { return d.geo; });
	var facilitiesGroup = facilities.group();
	
	var prefec = xf.dimension(function(d) { return d.variable; });
	var pop_pref = prefec.group().reduceSum(function (d) { return d.numbers; });
	
	var varallDim = xf.dimension(function(d) { return d.variable; });
	var varallGP = varallDim.group().reduceSum(function(d){return d.numbers;});
	
	var filterValues = xf.dimension(
            function( d )
            {
                return d.variable;
            } ).filter(
            function( d )
            {
                if(d=="NFI_Kit_cuisine_total" | d=="NFI_Moustiquaires" | d=="NFI_Nattes"|d=="NFI_Savons"|d=="NFI_Seau"|d=="NFI_Torche"|
				d=="NFI_Vetement_bebe"|d=="NFI_bidons"|d=="Kits_NFI_total"|d=="NFI_Baches")
                    return d;
            } );
	
	var filtered_group = {
		all: function () {
        return varallGP.top(Infinity).filter( function (d) { return d.value !== 0; } );
		}
	}

	var filterValues_pop = xf.dimension(
            function( d )
            {
                return d.variable;
            } ).filter(
            function( d )
            {
                if(d=="Individus_beneficiaires_WASH_total" | d=="Individus_beneficiaires_NFI_total" | 
				d=="Individus_beneficiaires_WASH_total"|d=="menages_beneficiaires_WASH_total")
                    return d;
            } );
	
	var filtered_group_pop = {
		all: function () {
        return varallGP.top(Infinity).filter( function (d) { return d.value !== 0; } );
		}
	}
	
	var IntervDim = xf.dimension(function(d) { return d['score_de_Consommation_alimentaire_Limite']; });
	var Intervgp = IntervDim.group();
	
	var FCS_acc = xf.dimension(function(d) { return d['score_de_Consommation_alimentaire_Acceptable']; });
	var FCS_accGroup = IntervDim.group();
	
	var stdateDim = xf.dimension(function(d) {return d.DD});
	var stdategp = stdateDim.group();
	
	var yeargp  = xf.dimension(function(d) { return d['year']; });
    var yeargroup = yeargp.group().reduceCount();
	var times = function(d) {return d.DD};

	var groupname = "marker-select";

  dc.leafletMarkerChart(".map",groupname)
      .dimension(facilities)
      .group(facilitiesGroup)
      .width(900)
      //.height(300)
      .center([6.6,19.90])
      .zoom(6)
      .cluster(false)
      .renderPopup(true)
      .filterByArea(true)
	  //.title(function (d) {return d.key + ": "+d.value+" individuals";})
    ;

  dc.rowChart("#cccm .pref",groupname)
        .dimension(pref)
        .group(NFI_tot)
		.valueAccessor(function(d) {
                    return d.value.violentCrimeRate;
                })
        .elasticX(true)
        .width(200)
        .height(350)
        .renderLabel(true)
        .colors(['#58585A'])
		.ordering(function (p) { return -p.value.violentCrimeRate;})
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  dc.rowChart("#cccm .prefpop",groupname)
        .dimension(partner)
        .group(partner_pop)
		.valueAccessor(function(d) {
            return d.value.totalbeneficaire;
         })
        .elasticX(true)
        .width(200)
        .height(350)
        .renderLabel(true)
        .colors(['#58585A'])
		.ordering(function (p) { return -p.value;})
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  dc.rowChart("#cccm .FCS_poor",groupname)
        .dimension(varallDim)
        .group(filtered_group)
		.valueAccessor(function(d) {
                    return d.value;
                })		
        .elasticX(true)
        .width(200)
        .height(500)
        .renderLabel(true)
        //.ordering(function (p) { return -p.value;})
       .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.OrRd[5])
			)
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  dc.rowChart("#cccm .FCS_borderline",groupname)
        .dimension(varallDim)
        .group(filtered_group_pop)
		.valueAccessor(function(d) {
                    return d.value;
                })		
        .elasticX(true)
        .width(200)
        .height(500)
        .renderLabel(true)
      //.ordering(function (p) { return -p.value;})
        .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.OrRd[5])
			)
		.elasticX(true)
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  dc.rowChart("#cccm .FCS_acceptable",groupname)
        .dimension(FCS_acc)
        .group(FCS_accGroup)
        .elasticX(true)
        .width(200)
        .height(150)
        .renderLabel(true)
        //.ordering(function (p) { return -p.value;})
        .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.OrRd[5])
			)
		.elasticX(true)
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  dc.rowChart("#cccm .year",groupname)
        .dimension(yeargp)
        .group(yeargroup)
        .elasticX(true)
        .width(200)
        .height(100)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
		.colors(d3.scale.category10())
        //.colors(['#CC3333'])
        //.colorDomain([0,0])
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

 dc.lineChart("#cccm .start_dates",groupname)
		.height(200)
		.width(550)
        .dimension(stdateDim)
		.group(stdategp)
		.x(d3.time.scale())
	    .round(d3.time.month.round)
	    .xUnits(d3.time.month)
	    .elasticY(true)
		.elasticX(true)
		.renderArea(true)
		.dotRadius(5)
		.xAxis().ticks(6)
		;

$('#reset').on('click', function (){
  dc.filterAll(groupname);
  dc.redrawAll(groupname);
  return false;
})


  dc.renderAll(groupname);
}

  
</script>

 <script src="js/bootstrap.js"></script>
<!-- Custom Theme JavaScript -->
<script>
// Closes the sidebar menu
$("#menu-close").click(function(e) {
    e.preventDefault();
    $("#sidebar-wrapper").toggleClass("active");
});

// Opens the sidebar menu
$("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#sidebar-wrapper").toggleClass("active");
});

// Scrolls to the selected menu item on the page
$(function() {
    $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {

            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top
                }, 1000);
                return false;
            }
        }
    });
});
</script>

</body>


</html>
