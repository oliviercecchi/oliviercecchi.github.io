<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
    <title>RRM RCA - MSA</title>
	
	<script type="text/javascript" src="js/RRM_RCA_area_intervention.js"></script>
	<script type="text/javascript" src="js/RRM_RCA_admin1.js"></script>

    <!-- Bootstrap -->
	
	<script src="js/html5.js"></script>
	
    <link type="text/css" rel="stylesheet" href="css/bootstrap.css">
    <link type="text/css" href="css/leaflet.css" rel="stylesheet"/>
    <link type="text/css" href="css/leaflet.markercluster.css" rel="stylesheet"/>

    <link rel="stylesheet" type="text/css" href="css/dc.css">
    <!-- Add IntroJs styles  -->
    <link rel="stylesheet" type="text/css" href="css/introjs.css">
    <link rel="stylesheet" type="text/css" href="css/dashboard.css">
    <link rel="stylesheet" type="text/css" href="css/colorbrewer.css">

    <link href="font-awesome-4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	

<style>
/* Change the styles below in order to customize your template */

body{font-family: Helvetica, Arial; font-weight: regular; font-size: 15px; color: #555; background-color: #FFF; margin: 0;}
h1{font-weight: bold; font-size: 31px; letter-spacing: -1px; color: #333; line-height: 33px;}
h3{font-weight: bold; font-size: 20px; color: #fff; text-transform: uppercase; margin: 10px 0 0 0;}
h4{font-size: 12px; color: #000; margin: 10px 0px 0px 10px; line-height:14px}
h5{font-size: 10px;font-style:italic; color: #000; margin: 0px 0px 0px 10px; line-height:10px}
p{margin: 8px 0 20px 0; line-height: 18px;}
a, a:visited{color: #397DB8; text-decoration: none;}
a:hover{text-decoration: underline;}

.wrapper{display: block; margin: 50px 0 0 0; padding: 4px 30px 0 30px;}

.map{background-color:#eee; position: absolute; top: 50px; left: 0; bottom: 0; width: 55%; *height:100%;}
.sidepanel{background-color:#b6b6b6; position: absolute; top: 0px; right: 0;  bottom: 0; width: 45%; height: 100%; overflow: auto}

.context{font-family: Helvetica, Arial; font-size: 13px; color: #999; padding: 10px 0 0 0;}
.subheader{border-bottom: 1px solid #ddd;}
.footer{border-top: 1px solid #ddd; margin-top: 30px;}
.titleBlock{text-align: right;
/* Here are the styles that makes the template responsive*/
@media only screen and (max-width: 768px) {
  .map{position: inherit; height: 400px; width: 100%; display: block;}
  .sidepanel{position: inherit; width: 100%;}
}
@media only screen and (max-width: 480px) {
  .map {height: 300px;}
}
.bar rect {
  shape-rendering: crispEdges;
}
.bar text {
  text-anchor: end;
}
.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}
</style>

</head>
 <body>
  <nav class="navbar navbar-inverse navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">RRM République Centrafricaine</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Type d'activités <span class="caret"></span></a>
			  
               <ul class="dropdown-menu" role="menu">
                <li><a href="reference_2014.html">Carte de référence 2014</a></li>
                <li><a href="reference_2015.html">Carte de référence 2015</a></li>
				<li><a href="alerte.html">Alertes</a></li>
                <li><a href="mex.html">Missions exploratoires</a></li>
                <li><a href="MSA.html">Enquêtes multi-sectorielles</a></li>
                <li><a href="inter.html">Interventions</a></li>
                <li><a href="pdm.html">PDM</a></li>
              </ul>
            </li>
			<li><a>MSA</a></li>
			<li><a class="reset" id="reset" href="#">Réinitialiser</a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
			<li style="top:12px"><img src="image/unicef-logo.png" width="125" height="25"style="border-width:0px;"><li>	
			<li><a> </a></li>
			<li style="top:7px"><img src="image/rrm.png" width="129" height="37"style="border-width:0px;"><li>	
			<li><a> </a></li>
			<li style="top:12px"><img src="image/REACH_logo.png" width="129" height="29"style="border-width:0px;"><li>					
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>   
	
   <div style="display: block;"  id="dashboard">
             <div class="row" id="cccm">
                <div  class="map" id="cccm"  > </div>

                <div class="sidepanel">
					<div class="wrapper">
						  <p id="gen"><h3>MSA - Enquêtes Multi-Sectorielles</h3></p>
					</div>
						
						<div class="row">
							<div  class="col-md-4">
								<div  class="pref" id="cccm" class="dc-chart">
								  <h4>Nombre de MSA</h4><h5>Par préfecture</h5>
								</div>
							</div>
							
							<div  class="col-md-4">
								<div  class="prefpop" id="cccm" class="dc-chart">
										<h4>IDPs affectés</h4><h5>Par préfecture</h5>
								</div>
								
							</div>
							
							 <div  class="col-md-4">
								<div  class="SCORE_NFI" id="cccm" class="dc-chart">
								  <h4>Score NFI moyen par village</h4>
								</div>
								
							</div>
						</div>
						 <div class="row">
							  <div  class="col-md-4">
								<div  class="FCS_poor" id="cccm" class="dc-chart">
									<h4>% de la population avec un SCA Pauvre**</h4><h5>Par village</h5>
								</div>
								
							  </div>
							  <div  class="col-md-4">
								<div  class="FCS_borderline" id="cccm" class="dc-chart">
								     <h4>% de la population avec un SCA Limite**</h4><h5>Par village</h5>
								</div>
							</div>
							 <div  class="col-md-4">
								<div  class="FCS_acceptable" id="cccm" class="dc-chart">
								     <h4>% de la population avec un SCA Pauvre ou Limite**</h4><h5>Par village</h5>
								</div>
							</div>
						</div>	  
						 <div class="row">
							  <div  class="col-md-4">
								<div  class="water" id="cccm" class="dc-chart">
									<h4>% de la population ayant accès à une eau de qualité ameliorée</h4><h5>Par village</h5>
								</div>
							  </div>
							  <div  class="col-md-4">
								<div  class="latrine" id="cccm" class="dc-chart">
								     <h4>% de la population ayant accès à une latrine ameliorée</h4><h5>Par village</h5>
								</div>
							</div>
							  <div  class="col-md-4">
								<div  class="abris" id="cccm" class="dc-chart">
								     <h4>% de la population vivant dans un abris correspondant aux standards minimums</h4><h5>Par village</h5>
								</div>
							</div>
						</div>	  
						<div class="row">
							<div  class="col-md-8">
							   <div Class ="start_dates" id="cccm" class="dc-lineChart">
								  <h4>Nombre de MSA effectuées</h4><h5>Selectionner le graphique pour filtrer par date</h5>
								</div>
							</div>
							 <div  class="col-md-4">
								<div  class="year" id="cccm" class="dc-chart">
								     <h4>Nombre de MSA par an</h4>
								</div>
							</div>
						</div>
						<div class="row">
							 <div  class="col-md-12">
							 <h5>* Score NFI: score basé sur la possession des principaux produits non alimentaires, un score élevé indique un déficit de ces principaux produits</h5>	
							<h5>** SCA ou Score de consommation alimentaire est un index composite basé sur la diversité de l'alimentation, la fréquence d'absorption et l'apport nutritionnel des différents groupes alimentaires. Cet index est divisé en trois groupes (pauvre, limite et acceptable)</h5>
							</div>
						</div>
					</div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="js/intro.js"></script>
    <script type="text/javascript" src="js/d3_002.js"></script>
    <script type="text/javascript" src="js/d3.js"></script>
    <script type="text/javascript" src="js/crossfilter.js"></script>
    <script type="text/javascript" src="js/dc.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
<!--maps-->
    <script type="text/javascript" src="js/leaflet.js"></script>
	<<script type="text/javascript"  src="js/esri-leaflet.js"></script>
    <script type="text/javascript" src="js/leaflet.markercluster.js"></script>
    <script type="text/javascript" src="js/dc.leaflet_msa.js"></script>
    <script type="text/javascript" src="js/colorbrewer.js"></script>

<script type="text/javascript">

/*     Markers      */

d3.csv("data/RRM_MSA.csv", function(error,data) {
	 
     drawMarkerArea(data);
});


function regroup(dim, cols) {
    var _groupAll = dim.groupAll().reduce(
        function(p, v) { // add
            cols.forEach(function(c) {
                p[c] += v[c];
            });
            return p;
        },
        function(p, v) { // remove
            cols.forEach(function(c) {
                p[c] -= v[c];
            });
            return p;
        },
        function() { // init
            var p = {};
            cols.forEach(function(c) {
                p[c] = 0;
            });
            return p;
        });
    return {
        all: function() {
            return d3.map(_groupAll.value()).entries();
        }
    };
}

function drawMarkerArea(data) {

	var dateFormat = d3.time.format("%Y-%m");
   	
	data.forEach(function (d) {
    d.DD  = dateFormat.parse(d.month);
	d.Individus_IDPs = +d.Individus_IDPs;
	d.Menage_retournes = +d.Menage_retournes;
	d.Menages_hote = +d.Menages_hote;
	d.Score_NFI = +d.Score_NFI;
	d.Individus_returnes = +d.Individus_returnes;
	d.Individus_hote = +d.Individus_hote;
	d.Menage_IDPs = +d.Menage_IDPs;
	d.Score_startegie_de_survie = +d.Score_startegie_de_survie;
	d.Score_Consommation_alimentaire = +d.Score_Consommation_alimentaire;

});
 

  var xf = crossfilter(data);

  var groupname = "marker-select";

  var facilities = xf.dimension(function(d) { return d.geo; });
  var facilitiesGroup = facilities.group();
  
  dc.leafletMarkerChart(".map",groupname)
      .dimension(facilities)
      .group(facilitiesGroup)
      .width(900)
      //.height(300)
      .center([6.6,19.90])
      .zoom(6)
      .cluster(false)
      .renderPopup(true)
      .filterByArea(true)
	  //.title(function (d) {return d.key + ": "+d.value+" individuals";})
    ;

  var pref = xf.dimension(function(d) { return d['PREF_NOM']; });
  var villsect = pref.group().reduceCount();
  
  dc.rowChart("#cccm .pref",groupname)
        .dimension(pref)
        .group(villsect)
		//.filter(function(d) { if (d !="NA") {return d;} })
		//.data(function(group) {
		//	return group.all().filter(function(kv) { return kv.key !="NA"; });
		//	})
        .elasticX(true)
        .width(200)
        .height(350)
        .renderLabel(true)
        .colors(['#58585A'])
		.ordering(function (p) { return -p.value;})
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

  var prefec = xf.dimension(function(d) { return d['PREF_NOM']; });
  var pop_pref = pref.group().reduceSum(function (d) { return d.Individus_déplacés; });
  
  dc.rowChart("#cccm .prefpop",groupname)
        .dimension(prefec)
        .group(pop_pref)
		//.filter("NA")
		//.filter(function(d) { if (d !="NA") {return d;} })
        .elasticX(true)
        .width(200)
        .height(350)
        .renderLabel(true)
        .colors(['#58585A'])
		.ordering(function (p) { return -p.value;})
        .colorDomain([0,0])
        .colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

		
		
  var ONGDim  = xf.dimension(function(d) { return d['Score_NFI']; });
  var ONGsect = ONGDim.group();
  
  var NONGsect = ONGDim.group().reduce(reduceAdd, reduceRemove, reduceInitial);

		function reduceAdd(p, v) {
		  ++p.count;
		  p.total += v.value;
		  return p;
		}

		function reduceRemove(p, v) {
		  --p.count;
		  p.total -= v.value;
		  return p;
		}

		function reduceInitial() {
		  return {count: 0, total: 0};
		}

	
var choc = xf.dimension(function(d) { return d['Score_NFI']; });
var chocDim = choc.group().reduceCount();

  dc.rowChart("#cccm .SCORE_NFI",groupname)
        .dimension(choc)
        .group(chocDim)
		//.data(function(group) {return group.all().filter(function(kv) { return kv.key !=""; });})
        .width(200)
        .height(350)
        .renderLabel(true)
       // .ordering(function (p) { return -p.value;})
        .colors(d3.scale.linear()
			.domain([5,3])
			.range(colorbrewer.RdYlGn[11])
		)
        //.colorDomain([0,0])
		.elasticX(true)
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));
		
var Direct_Contractor_VoucherDim = xf.dimension(function(d) { return d['score_de_Consommation_alimentaire_Pauvre']; });
var Direct_Contractor_Vouchergp = Direct_Contractor_VoucherDim.group().reduceCount();

  dc.rowChart("#cccm .FCS_poor",groupname)
        .dimension(Direct_Contractor_VoucherDim)
        .group(Direct_Contractor_Vouchergp)
        .elasticX(true)
        .width(200)
        .height(170)
        .renderLabel(true)
        //.ordering(function (p) { return -p.value;})
       .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.OrRd[5])
			)
        //.colorDomain([0,0])
       //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));
		
var IntervDim = xf.dimension(function(d) { return d['score_de_Consommation_alimentaire_Limite']; });
var Intervgp = IntervDim.group();

  dc.rowChart("#cccm .FCS_borderline",groupname)
        .dimension(IntervDim)
        .group(Intervgp)
        .elasticX(true)
        .width(200)
        .height(170)
        .renderLabel(true)
      //.ordering(function (p) { return -p.value;})
        .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.OrRd[5])
			)
      //.colors(d3.scale.category(["#3182bd","#6baed6","#6baed6","#9ecae1","#9ecae1","#c6dbef","#c6dbef"]))
		.elasticX(true)
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

var FCS_acc = xf.dimension(function(d) { return d['score_de_Consommation_alimentaire_PauvreBorder']; });
var FCS_accGroup = FCS_acc.group();

  dc.rowChart("#cccm .FCS_acceptable",groupname)
        .dimension(FCS_acc)
        .group(FCS_accGroup)
        .elasticX(true)
        .width(200)
        .height(170)
        .renderLabel(true)
        //.ordering(function (p) { return -p.value;})
        .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.OrRd[5])
			)
		.elasticX(true)
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));
		
var waterDim = xf.dimension(function(d) { return d['des_menages_avec_un_source_d_eau_potable_amelioree']; });
var waterDimGroup = waterDim.group().reduceCount();

  dc.rowChart("#cccm .water",groupname)
        .dimension(waterDim)
        .group(waterDimGroup)
        .elasticX(true)
        .width(200)
        .height(170)
        .renderLabel(true)
        //.ordering(function (p) { return -p.value;})
       .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.PuBu[5])
			)
        //.colorDomain([0,0])
       //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));
		
var latrineDim = xf.dimension(function(d) { return d['des_menages_ayant_acces_a_une_latrine_hygienique']; });
var latrineGP = latrineDim.group();

  dc.rowChart("#cccm .latrine",groupname)
        .dimension(latrineDim)
        .group(latrineGP)
        .elasticX(true)
        .width(200)
        .height(170)
        .renderLabel(true)
      //.ordering(function (p) { return -p.value;})
        .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.Greys[5])
			)
      //.colors(d3.scale.category(["#3182bd","#6baed6","#6baed6","#9ecae1","#9ecae1","#c6dbef","#c6dbef"]))
		.elasticX(true)
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

var shelterDim = xf.dimension(function(d) { return d['de_menages_vivant_ds_un_abris_en_dessous_des_standard']; });
var shelterGP = shelterDim.group();

  dc.rowChart("#cccm .abris",groupname)
        .dimension(shelterDim)
        .group(shelterGP)
        .elasticX(true)
        .width(200)
        .height(170)
        .renderLabel(true)
        //.ordering(function (p) { return -p.value;})
        .colors(d3.scale.ordinal()
			.domain(["0-20%", "20-40%", "40-60%","60-80%","80-100%"])
			.range(colorbrewer.Greens[5])
			)
		.elasticX(true)
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));
		
 
 var yeargp  = xf.dimension(function(d) { return d['year']; });
  var yeargroup = yeargp.group().reduceCount();

  dc.rowChart("#cccm .year",groupname)
        .dimension(yeargp)
        .group(yeargroup)
        .elasticX(true)
        .width(200)
        .height(100)
        .renderLabel(true)
        .ordering(function (p) { return -p.value;})
		.colors(d3.scale.category10())
        //.colors(['#CC3333'])
        //.colorDomain([0,0])
        //.colorAccessor(function(d, i){return 1;})
        .xAxis().ticks(4).tickFormat(d3.format("s"));

var stdateDim = xf.dimension(function(d) {return d.DD});
var stdategp = stdateDim.group();
var times = function(d) {return d.DD};

 dc.lineChart("#cccm .start_dates",groupname)
		.height(200)
		.width(550)
        .dimension(stdateDim)
		.group(stdategp)
		.x(d3.time.scale())
	    .round(d3.time.month.round)
	    .xUnits(d3.time.month)
	    .elasticY(true)
		.elasticX(true)
		.renderArea(true)
		.dotRadius(5)
		.xAxis().ticks(6)
		;

$('#reset').on('click', function (){
  dc.filterAll(groupname);
  dc.redrawAll(groupname);
  return false;
})


  dc.renderAll(groupname);
}

  
</script>

 <script src="js/bootstrap.js"></script>
<!-- Custom Theme JavaScript -->
<script>
// Closes the sidebar menu
$("#menu-close").click(function(e) {
    e.preventDefault();
    $("#sidebar-wrapper").toggleClass("active");
});

// Opens the sidebar menu
$("#menu-toggle").click(function(e) {
    e.preventDefault();
    $("#sidebar-wrapper").toggleClass("active");
});

// Scrolls to the selected menu item on the page
$(function() {
    $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') || location.hostname == this.hostname) {

            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            if (target.length) {
                $('html,body').animate({
                    scrollTop: target.offset().top
                }, 1000);
                return false;
            }
        }
    });
});
</script>

</body>


</html>
